https://192.168.225.50/ui/
Ansible@vmtraining.local
Ansible!09_20$24!


sa / pass

https://www.perplexity.ai/


машина тренера:
DNS Name:	ws.lab.example.com
IP Addresses:	172.16.195.142

мой сервер управления
DNS Name:	ws.lab.example.com
IP Addresses:	172.16.195.155

serverA
DNS Name:	servera.lab.example.com
IP Addresses:	172.16.195.163




#Ansible день 1


Инвентори по умолчанию лежит
/etc/ansible/hosts



Настройка Ansible
/etc/ansible/ansible.cfg`-низкий приоритет
~/.ansible.cfg - средний приоритет
./ansible.cfg - высокий приоритет





Плагины для VSCode для удаленного подключения:
Remote -ssh
Remote Explorer
Remote tunels

список управляемых хостов
ansible all -i inventory.cfg --list-hosts

пинг всех хостов
ansible all -m ping

Выполнить неидемпотентую команду(BAD)
ansible all -m command -a /usr/bin/hostname -o

Идемпотентные коанды через модули -m :
ansible all -m command -a 'id'
ansible all -m copy  -a 'content="This server is managed by Ansible.\n" dest=/etc/motd' --become
ansible all -m command -a 'cat /etc/motd'
ansible -m user -a 'name=newbie uid=4000 state=present' -b


#Ansible день 2

Проверка синтаксиса плейбука
ansible-playbook --syntax-check webserver.yml

Проверка выполнения(сухой прогон)
ansible-playbook -C webserver.yml


Просмотр документации по модулям
ansible-doc -l #список модулей
ansible-doc user #инфа по конкретному модулю
ansible-doc -s yum #инфа по конкретному модулю сокращенно

Расположение модулей bultin
/usr/lib/python3.9/site-packages/ansible/modules/


## Модуль 4 Переменные

!!нельзя называть пременные как имя модуля

приоритет перменных:
https://docs.ansible.com/ansible/latest/playbook_guide/playbooks_variables.html#where-to-set-variables


Если переменная указана в начале ключа, тоее нужно помещать в кавычки

- name: Creates the user {{ user }}
  user:  
    name: "{{ users }}"

Переменные в плейбук можно определеить прямо или через файл:

- hosts: all
  vars:
    users: joe

- hosts: all
  vars_files:
    - vars/users.yml

##Вместо переменных в инвентори использовать каталоги group_vars и host_vars

в group_vars создается файл по имени группы
в host_vars создается файл с именем хоста

принудителный сбор фактов
- name: get manual facts
  setup:

для записи своих ansible_facts на хосте ложим в папку с расширением .fact в формате ini
/etc/ansible/facts.d/users.fact

обращзаться к ней можно так:

-name: ansible facts local
  debag:
    var: ansible facts.ansible_local.users

можно выключить сбор фактов
gather_facts: no


Магические переменные
Самые полезные из них:
hostvars – содержит переменные для управляемых хостов и может быть использован для получения значений переменных другого переменных другого управляемого узла. Не включает факты управляемого узла, если они еще не были собраны для этого узла;
group_names – перечисляет все группы, в которых находится текущий управляемый хост;
groups – перечисляет все группы и хосты в инвентаре;
inventory_hostname – содержит имя хоста для текущего управляемого хоста, настроенного в инвентаризации. Может отличаться от имени хоста, сообщаемого фактами, по различным причинам.



/etc/ansible/facts.d
